<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        const DEV_MODE = false; 
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="CiviTable: Live-syncing timetable for Civil Engineering Semester VI.">
    <title>CiviTable</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 15px rgba(59, 130, 246, 0.4)',
                    }
                }
            }
        }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link rel="manifest" href="./manifest.json">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
        }
        
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        /* --- BACKGROUND --- */
        .bg-dot-pattern {
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 24px 24px;
        }
        .dark .bg-dot-pattern {
            background-image: radial-gradient(#262626 1px, transparent 1px);
        }

        /* --- GLASS NAV --- */
        .glass-nav {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .dark .glass-nav {
            background: rgba(10, 10, 10, 0.85);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        /* --- ANIMATIONS --- */
        .card-enter { animation: slideIn 0.3s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; opacity: 0; transform: translateY(10px); }
        @keyframes slideIn { to { opacity: 1; transform: translateY(0); } }

        .btn-press { transition: transform 0.1s; }
        .btn-press:active { transform: scale(0.95); }

        /* --- DIALOG --- */
        .dialog-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.7); opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 50; backdrop-filter: blur(4px); }
        .dialog-content {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: white; border-top-left-radius: 24px; border-top-right-radius: 24px;
            padding: 24px; padding-bottom: env(safe-area-inset-bottom, 24px);
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            z-index: 51; pointer-events: none; box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
        }
        .dark .dialog-content { background: #151515; border-top: 1px solid #333; }

        .dialog.open .dialog-backdrop { opacity: 1; pointer-events: auto; }
        .dialog.open .dialog-content { transform: translateY(0); pointer-events: auto; }

        /* --- UTILS --- */
        .safe-pb { padding-bottom: env(safe-area-inset-bottom, 24px); }
        
        /* --- UPDATE TOAST --- */
        #update-toast {
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #update-toast.visible {
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-[#050505] text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-300 bg-dot-pattern">

    <nav class="glass-nav sticky top-0 z-40">
        <div class="max-w-md mx-auto px-5 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                
                <svg class="w-10 h-10 shadow-md rounded-2xl" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" fill="none">
                    <defs>
                        <linearGradient id="bgGlow" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="#3B82F6"/>
                            <stop offset="100%" stop-color="#6366F1"/>
                        </linearGradient>
                        <linearGradient id="blueGrad" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="#38BDF8"/>
                            <stop offset="100%" stop-color="#2563EB"/>
                        </linearGradient>
                        <linearGradient id="purpleGrad" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="#C084FC"/>
                            <stop offset="100%" stop-color="#7C3AED"/>
                        </linearGradient>
                        <linearGradient id="orangeGrad" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="#FDBA74"/>
                            <stop offset="100%" stop-color="#F97316"/>
                        </linearGradient>
                        <linearGradient id="greenGrad" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="#4ADE80"/>
                            <stop offset="100%" stop-color="#16A34A"/>
                        </linearGradient>
                    </defs>
                    <rect x="112" y="112" width="800" height="800" rx="180" class="fill-white dark:fill-[#202020]"/>
                    <rect x="240" y="240" width="220" height="220" rx="48" fill="url(#blueGrad)"/>
                    <rect x="564" y="240" width="220" height="220" rx="48" fill="url(#purpleGrad)"/>
                    <rect x="240" y="564" width="220" height="220" rx="48" fill="url(#orangeGrad)"/>
                    <rect x="564" y="564" width="220" height="220" rx="48" fill="url(#greenGrad)"/>
                </svg>

                <div>
                    <h1 class="text-xl font-black tracking-tight leading-none">CIVI<span class="text-blue-600 dark:text-blue-400">TABLE</span></h1>
                    <div class="flex items-center gap-1.5 mt-0.5">
                        <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span>
                        <span id="sync-status" class="text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest">Live Sync</span>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-2">
                <button id="install-btn" class="hidden px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-full text-[10px] font-bold uppercase tracking-wider shadow-lg shadow-blue-500/30 transition-all btn-press">
                    Get App
                </button>

                <button id="theme-toggle" aria-label="Toggle Theme" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-[#222] flex items-center justify-center text-gray-600 dark:text-gray-300 btn-press transition-colors hover:bg-gray-200 dark:hover:bg-[#333]">
                    <svg class="w-5 h-5 dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    <svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                </button>
            </div>
        </div>
    </nav>

    <div id="app" class="max-w-md mx-auto p-5 safe-pb">
        
        <div class="flex items-end justify-between mb-2">
            <div>
                <p class="text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-1">Semester VI</p>
                <h2 class="text-3xl font-black tracking-tight" id="header-date">Oct 24</h2>
            </div>
            
            <div class="flex bg-gray-200 dark:bg-[#222] rounded-xl p-1 hidden" id="elective-control"></div>
        </div>

        <div class="flex justify-between gap-2 mb-6 p-1" id="day-nav"></div>

        <div id="schedule-list" class="space-y-4 min-h-[300px]"></div>

    </div>

    <div id="modal" class="dialog">
        <div class="dialog-backdrop" onclick="closeModal()"></div>
        <div class="dialog-content"></div>
    </div>

    <div id="ios-install-modal" class="dialog">
        <div class="dialog-backdrop" onclick="closeIOSModal()"></div>
        <div class="dialog-content">
            <div class="flex justify-center mb-4">
                <div class="w-12 h-1.5 bg-gray-200 dark:bg-[#333] rounded-full"></div>
            </div>
            <div class="text-center">
                <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                </div>
                <h3 class="text-xl font-bold mb-2 dark:text-white">Install CiviTable</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">Install this app on your iPhone for the best experience.</p>
                <div class="space-y-4 text-left bg-gray-50 dark:bg-[#222] p-4 rounded-xl border border-gray-100 dark:border-[#333]">
                    <div class="flex items-center gap-3">
                        <span class="w-6 h-6 rounded-full bg-white dark:bg-[#333] flex items-center justify-center text-xs font-bold shadow-sm">1</span>
                        <span class="text-sm font-medium dark:text-gray-300">Tap the <span class="font-bold">Share</span> button</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="w-6 h-6 rounded-full bg-white dark:bg-[#333] flex items-center justify-center text-xs font-bold shadow-sm">2</span>
                        <span class="text-sm font-medium dark:text-gray-300">Scroll down & tap <span class="font-bold">Add to Home Screen</span></span>
                    </div>
                </div>
                <button onclick="closeIOSModal()" class="mt-6 w-full py-3 rounded-xl bg-blue-600 text-white font-bold text-sm">Got it</button>
            </div>
        </div>
    </div>

    <div id="update-toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-sm bg-black/90 dark:bg-white/90 backdrop-blur-md text-white dark:text-black p-4 rounded-2xl shadow-2xl flex items-center justify-between z-50 transform translate-y-[150%]">
        <div class="flex items-center gap-3">
            <div class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
            <span class="text-sm font-bold">New update available</span>
        </div>
        <button id="reload-btn" class="text-xs bg-white/20 dark:bg-black/10 px-3 py-1.5 rounded-lg font-bold hover:bg-white/30 transition-colors">
            RELOAD
        </button>
    </div>

    <script src="data.js"></script>
    <script>
        // --- GLOBAL INSTALL HANDLER ---
        let globalDeferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            globalDeferredPrompt = e;
            const btn = document.getElementById('install-btn');
            if (btn) btn.classList.remove('hidden');
        });

        const APP_CONFIG = {
            showToggle: false, 
            toggleTitle: "Elective",
            toggleOptions: [ { code: 'CE23632', label: 'PE-II' }, { code: 'BATCH_B', label: 'Batch B' } ],
            defaultSelection: 'CE23632'
        };

        const colorMap = {
            CE23611: { from: "from-orange-400", to: "to-amber-500", bg: "bg-orange-50 dark:bg-orange-900/10", shadow: "shadow-orange-500/20", border: "border-orange-500" },
            CE23612: { from: "from-emerald-400", to: "to-green-600", bg: "bg-emerald-50 dark:bg-emerald-900/10", shadow: "shadow-emerald-500/20", border: "border-emerald-500" },
            CE23613: { from: "from-violet-500", to: "to-purple-600", bg: "bg-violet-50 dark:bg-violet-900/10", shadow: "shadow-violet-500/20", border: "border-violet-500" },
            CE23631: { from: "from-blue-500", to: "to-indigo-600", bg: "bg-blue-50 dark:bg-blue-900/10", shadow: "shadow-blue-500/20", border: "border-blue-500" },
            CE23632: { from: "from-pink-500", to: "to-rose-600", bg: "bg-pink-50 dark:bg-pink-900/10", shadow: "shadow-pink-500/20", border: "border-pink-500" },
            DEFAULT: { from: "from-gray-500", to: "to-gray-600", bg: "bg-white dark:bg-[#151515]", shadow: "shadow-gray-500/20", border: "border-gray-500" }
        };

        let state = {
            date: new Date(),
            elective: localStorage.getItem('selected_toggle') || APP_CONFIG.defaultSelection
        };

        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            setupControls();
            render();
            updateLastUpdated();
            setupPWA();
            setInterval(() => { render(); updateLastUpdated(); }, 60000); 
        });

        function setupPWA() {
            const installBtn = document.getElementById('install-btn');
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;

            if (globalDeferredPrompt) installBtn.classList.remove('hidden');
            if (isIOS && !isStandalone) installBtn.classList.remove('hidden');

            installBtn.addEventListener('click', () => {
                if (globalDeferredPrompt) {
                    globalDeferredPrompt.prompt();
                    globalDeferredPrompt.userChoice.then((result) => {
                        if (result.outcome === 'accepted') installBtn.classList.add('hidden');
                        globalDeferredPrompt = null;
                    });
                } else if (isIOS) {
                    document.getElementById('ios-install-modal').classList.add('open');
                }
            });

            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => {
                        reg.addEventListener('updatefound', () => {
                            const newWorker = reg.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showUpdateToast(newWorker);
                                }
                            });
                        });
                    })
                    .catch(err => console.log('SW Fail:', err));
                
                let refreshing;
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    if (refreshing) return;
                    window.location.reload();
                    refreshing = true;
                });
            }
        }

        function showUpdateToast(worker) {
            const toast = document.getElementById('update-toast');
            toast.classList.add('visible');
            document.getElementById('reload-btn').addEventListener('click', () => {
                worker.postMessage({ type: 'SKIP_WAITING' });
            });
        }

        function updateLastUpdated() {
            const el = document.getElementById('sync-status');
            if (!el || !window.lastUpdatedDate) return;
            const diff = Math.floor((new Date() - new Date(window.lastUpdatedDate)) / 1000);
            let text = diff < 60 ? 'UPDATED JUST NOW' : 
                       diff < 3600 ? `UPDATED ${Math.floor(diff/60)}M AGO` : 
                       diff < 86400 ? `UPDATED ${Math.floor(diff/3600)}H AGO` : 
                       `UPDATED ${Math.floor(diff/86400)}D AGO`;
            el.innerText = text;
        }

        function setupControls() {
            const controlDiv = document.getElementById('elective-control');
            if (APP_CONFIG.showToggle) {
                controlDiv.classList.remove('hidden');
                controlDiv.innerHTML = APP_CONFIG.toggleOptions.map(opt => 
                    `<button onclick="setElective('${opt.code}')" 
                        class="px-4 py-2 rounded-lg text-xs font-bold transition-all btn-press ${state.elective === opt.code ? 'bg-white dark:bg-[#333] text-black dark:text-white shadow-sm' : 'text-gray-500'}" 
                        data-val="${opt.code}">${opt.label}</button>`
                ).join('');
            } else {
                controlDiv.classList.add('hidden');
            }
        }

        function render() {
            const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            const dayName = state.date.toLocaleDateString('en-US', { weekday: 'long' });
            
            document.getElementById('header-date').innerText = state.date.toLocaleDateString('en-US', { weekday: 'short', day: 'numeric' });
            
            const navContainer = document.getElementById('day-nav');
            navContainer.innerHTML = days.map((d, i) => {
                const isSelected = d === dayName;
                const isToday = new Date().toLocaleDateString('en-US',{weekday:'long'}) === d;
                const label = d.substring(0,3).toUpperCase();
                const activeClasses = 'relative z-10 bg-gradient-to-br from-blue-600 to-indigo-600 text-white shadow-lg shadow-blue-500/30 scale-105 border-transparent';
                const inactiveClasses = 'bg-white dark:bg-[#151515] text-gray-500 dark:text-gray-500 hover:bg-gray-50 dark:hover:bg-[#222] border-transparent';

                return `
                <button onclick="gotoDay(${i})" class="flex-1 min-w-0 aspect-square rounded-2xl border-2 flex flex-col items-center justify-center transition-all btn-press ${isSelected ? activeClasses : inactiveClasses}">
                    <span class="text-[10px] font-bold tracking-wider">${label}</span>
                    ${isToday && !isSelected ? '<div class="w-1 h-1 bg-green-500 rounded-full mt-1"></div>' : ''}
                </button>`;
            }).join('');

            const container = document.getElementById('schedule-list');
            const schedule = timetableData.schedule[dayName] || [];

            if (schedule.length === 0) {
                container.innerHTML = `
                <div class="py-20 flex flex-col items-center opacity-50">
                    <div class="w-16 h-16 bg-gray-200 dark:bg-[#222] rounded-full flex items-center justify-center mb-4">
                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <span class="font-bold text-gray-500">No classes today</span>
                </div>`;
                return;
            }

            container.innerHTML = schedule.map((slot, idx) => {
                if (APP_CONFIG.showToggle) {
                    const isOption = APP_CONFIG.toggleOptions.some(o => o.code === slot.courseCode);
                    if (isOption && slot.courseCode !== state.elective) return ''; 
                }

                if (slot.type === 'BREAK' || slot.type === 'LUNCH' || slot.type === 'FREE') {
                    const label = slot.type === 'FREE' ? 'FREE SLOT' : slot.type;
                    return `
                    <div class="flex items-center gap-4 py-2 opacity-60 card-enter" style="animation-delay:${idx*0.05}s">
                        <div class="w-16 text-right font-mono text-[10px] font-bold text-gray-500 dark:text-gray-400">${slot.time.split(' - ')[0]}</div>
                        <div class="flex-1 h-px bg-gray-200 dark:bg-gray-800"></div>
                        <div class="text-[10px] font-bold text-gray-400 tracking-widest">${label}</div>
                    </div>`;
                }

                const course = courseData[slot.courseCode] || {};
                const theme = colorMap[slot.courseCode] || colorMap.DEFAULT;
                const startTime = slot.time.split(' - ')[0];
                const endTime = slot.time.split(' - ')[1].replace(' PM','').replace(' AM','');
                const shortCode = course.shortCode || slot.courseCode.substring(0,2);

                return `
                <div onclick="openModal('${slot.courseCode}')" class="group flex items-stretch h-22 ${theme.bg} rounded-2xl shadow-sm border border-gray-100 dark:border-[#222] border-l-[6px] ${theme.border} btn-press cursor-pointer card-enter relative overflow-hidden" style="animation-delay:${idx*0.05}s">
                    <div class="w-20 flex-shrink-0 flex flex-col justify-center items-center border-r border-gray-100 dark:border-[#222] bg-white/50 dark:bg-[#1a1a1a]/50">
                        <span class="font-bold text-sm text-gray-900 dark:text-white">${startTime}</span>
                        <span class="text-[10px] font-medium text-gray-500 dark:text-gray-400 mt-0.5">${endTime}</span>
                    </div>
                    <div class="flex-1 p-3 flex items-center gap-3 min-w-0">
                        <div class="w-11 h-11 rounded-xl flex-shrink-0 flex items-center justify-center bg-gradient-to-br ${theme.from} ${theme.to} text-white font-black text-sm tracking-wide shadow-md ${theme.shadow}">
                            ${shortCode}
                        </div>
                        <div class="flex-1 min-w-0 flex flex-col justify-center">
                            <div class="flex justify-between items-center mb-1 gap-2">
                                <h3 class="text-xs font-bold text-gray-900 dark:text-gray-100 truncate min-w-0">${slot.courseCode}</h3>
                                <span class="px-2 py-0.5 rounded-md bg-white/60 dark:bg-[#222] text-[10px] font-bold text-gray-500 whitespace-nowrap flex-shrink-0">${slot.room || 'N/A'}</span>
                            </div>
                            <p class="text-[11px] font-medium leading-snug text-gray-600 dark:text-gray-400 truncate">${course.title || 'Course Details'}</p>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function gotoDay(idx) {
            const currentDay = (state.date.getDay() === 0) ? 6 : state.date.getDay() - 1;
            const diff = idx - currentDay;
            const newDate = new Date(state.date);
            newDate.setDate(state.date.getDate() + diff);
            state.date = newDate;
            render();
            if(navigator.vibrate) navigator.vibrate(5);
        }

        function setElective(code) {
            state.elective = code;
            localStorage.setItem('selected_toggle', code);
            setupControls();
            render();
        }

        function openModal(code) {
            const course = courseData[code];
            const modal = document.getElementById('modal');
            const theme = colorMap[code] || colorMap.DEFAULT;
            let schedHtml = '';
            timetableData.days.forEach(d => {
                (timetableData.schedule[d]||[]).forEach(s => {
                    if(s.courseCode === code) schedHtml += `<div class="flex justify-between items-center py-2.5 border-b border-gray-100 dark:border-[#222] last:border-0 text-xs"><span class="font-bold text-gray-500 uppercase tracking-wide">${d.substring(0,3)}</span><span class="font-bold text-gray-900 dark:text-gray-200">${s.time}</span></div>`;
                });
            });
            modal.querySelector('.dialog-content').innerHTML = `
                <div class="flex justify-center mb-6"><div class="w-12 h-1.5 bg-gray-200 dark:bg-[#333] rounded-full"></div></div>
                <div class="flex items-start gap-4 mb-6">
                    <div class="w-16 h-16 rounded-2xl flex items-center justify-center bg-gradient-to-br ${theme.from} ${theme.to} text-white font-black text-2xl shadow-lg ${theme.shadow}">${course.shortCode || code.substring(0,2)}</div>
                    <div class="flex-1 pt-1">
                        <div class="flex justify-between items-start"><h2 class="text-2xl font-black tracking-tight leading-none mb-1 text-gray-900 dark:text-white">${code}</h2><button onclick="closeModal()" class="w-8 h-8 rounded-full bg-gray-100 dark:bg-[#222] flex items-center justify-center text-gray-500">âœ•</button></div>
                        <p class="text-sm font-medium leading-snug text-gray-500 dark:text-gray-400 mt-1">${course.title}</p>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div class="bg-gray-50 dark:bg-[#111] p-4 rounded-xl border border-gray-100 dark:border-[#222]"><div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Credits</div><div class="text-lg font-bold text-gray-900 dark:text-white">${course.credits}</div></div>
                    <div class="bg-gray-50 dark:bg-[#111] p-4 rounded-xl border border-gray-100 dark:border-[#222]"><div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Staff</div><div class="text-sm font-bold text-gray-900 dark:text-white truncate">${course.staff}</div></div>
                </div>
                <div class="bg-gray-50 dark:bg-[#111] border border-gray-100 dark:border-[#222] rounded-xl p-5"><div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-2">Weekly Schedule</div>${schedHtml}</div>`;
            modal.classList.add('open');
            if(navigator.vibrate) navigator.vibrate(10);
        }

        function closeModal() { document.getElementById('modal').classList.remove('open'); }
        function closeIOSModal() { document.getElementById('ios-install-modal').classList.remove('open'); }

        function initTheme() {
            const saved = localStorage.getItem('theme');
            const sysDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (saved === 'dark' || (!saved && sysDark)) document.documentElement.classList.add('dark');
            document.getElementById('theme-toggle').addEventListener('click', () => {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            });
        }
    </script>
</body>
</html>
